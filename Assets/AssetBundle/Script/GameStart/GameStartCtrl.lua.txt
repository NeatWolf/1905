GameStartCtrl = {}

-- 加载登录系统
function GameStartCtrl:Init()
    local subObj = LoadManager:Load(ABManager:LoadAsset("prefab", "LoginTest"), "UI", true):GetComponent("UISubObject")
    subObj.buttons[0].onClick:AddListener(
        function()
            -- 黑遮罩淡入出，登陆成功
            UICtrl:CutTo(
                1,
                function()
                    CS.UnityEngine.Object.Destroy(subObj.gameObject)
                    GameStartCtrl:LoadingBar()
                end
            )
        end
    )
end

-- 登录成功，加载进度条，加载所有数据
function GameStartCtrl:LoadingBar()
    -- 加载 进度条
    local LoadingPanel = LoadManager:Load(ABManager:LoadAsset("prefab", "LoadingProcess"), "UI", true):GetComponent("UISubObject")
    local barImage = LoadingPanel.images[0]
    Core.countDown = 1
    local time = Core.countDown
    Core.cdEvent = function()
        barImage.fillAmount = 1 - Core.countDown / time
        if barImage.fillAmount == 1 then
            -- 加载完成
            UICtrl:CutTo(
                1,
                function()
                    -- 进入游戏主场景，销毁不需要的UI
                    CS.UnityEngine.Object.Destroy(LoadingPanel.gameObject)
                    -- 读取主场景脚本，清除GameStartCtrl占用
                    LoadManager:LoadSystem("MainScene")

                    GameStartCtrl = nil
                end
            )
        end
    end

    -- 加载 静态数据策划表
    StaticDataModel:ReadOut()
    -- 加载 玩家的本地数据，并合并成完整数据
    PlayerDataModel:ReadOut()
end
