--数据面板控制器，触摸控制
DataPanelCtrl = {}

--DataPanel组件，内有动画机和金币妹汁Text
DataPanelView = nil

--触摸好感度偏移
local touchFavorable = 5

--触摸事件
function DataPanelCtrl:GalTouch(touchType)
    --根据1 - 3的类型决定最终触发的触摸
    --在已有的动作列表中随机一个
    --优先选择type * 100 的ID组

    --从当前组开始遍历
    local num = 0
    for i = touchType * 100, touchType * 100 + 50 do
        -- 统计此组触摸个数
        for _, touch in pairs(FinalData.touch) do
            if touch.ID == i then
                num = num + 1
            end
        end
    end

    local touchID = 0
    if num > 0 then
        touchID = CS.UnityEngine.Random.Range(touchType * 100, touchType * 100 + num)
    else
        local v = CS.UnityEngine.Random.Range(1, #FinalData.touch + 1)
        touchID = FinalData.touch[v - v % 1].ID
    end
    DataPanelView.animator:SetInteger('TouchID', touchID - touchID % 1)

    --好感度增加
    if FinalData.favorable < FinalData.building[1].level * 50 then
        if touchType == 1 then
            FinalData.favorable = FinalData.favorable + math.random(10 + touchFavorable, 14 + touchFavorable)
        elseif touchType == 2 then
            FinalData.favorable = FinalData.favorable + math.random(12 + touchFavorable, 16 + touchFavorable)
        else
            FinalData.favorable = FinalData.favorable + math.random(14 + touchFavorable, 18 + touchFavorable)
        end
    end
    if FinalData.favorable >= FinalData.building[1].level * 50 then
        FinalData.favorable = FinalData.building[1].level * 50 - 1
    end

    --刷新
    BuildingPanelCtrl:DisplayBuildingData()
end

--初始化
function DataPanelCtrl:Init()
    local prefeb = ABManager:LoadAsset('prefebs', 'Canvas_Data')
    local panel = Loader:Load(prefeb, '/UI')
    DataPanelView = panel:GetComponent('DataPanelView')
end

--刷新数据显示
function DataPanelCtrl:DisplayData()
    local str = FinalData.gold - FinalData.gold % 1 + 0.0 .. ''
    DataPanelView.gold.text = string.sub(str, 0, #str - 2)
    str = FinalData.girlJuice - FinalData.girlJuice % 1 + 0.0 .. ''
    DataPanelView.girlJuice.text = string.sub(str, 0, #str - 2)
end
