-- 详细信息窗口

DetailView = {}

DetailView.Panel = nil
DetailView.HeroData = nil
DetailView.EquipList = nil
DetailView.Equipments = nil

function DetailView:Init()
    -- print("进入详情视图")
    self.Panel = RoleCtrl.Panel.go[4]:GetComponent("UISubObject")

    self.Panel.buttons[0].onClick:AddListener(
        function ()
            self.Panel.gameObject:SetActive(fasle)
            RoleView:ShowHeroInfo(self.HeroData)
        end
    )
    self.Panel.buttons[1].onClick:AddListener(
        function ()
            self.Panel.gameObject:SetActive(fasle)
            RoleCtrl:ChangeCurrentRole()
        end
    )
    self.Panel.buttons[2].onClick:AddListener(
        function ()

        end
    )

end


function DetailView:ShowDetail(heroData, equipList, equipments)
    self.HeroData = heroData

    -- 显示英雄简介
    self.Panel.tmps[0].text = heroData.Description

    -- 显示上方装备列表（已装备）
    self.EquipList = equipList
    for i=1, 6 do
        if self.EquipList[i] ~= nil then
            self.Panel.texts[i-1].text = ""
            self.Panel.images[i-1].sprite = ABManager:LoadAsset("texture", self.EquipList[i].ItemID, CS.UnityEngine.Sprite)
            --self.Panel.images[i-1].sprite = ABManager:LoadAsset("texture", "Test", CS.UnityEngine.Sprite)
            self.Panel.images[i-1].color = CS.UnityEngine.Color(1,1,1,1)
        else
            self.Panel.images[i-1].sprite = nil
            self.Panel.images[i-1].color = CS.UnityEngine.Color(1,1,1,0.5)
            if i == 1 then
                self.Panel.texts[i-1].text = "武器"
            elseif i == 2 then
                self.Panel.texts[i-1].text = "頭盔"
            elseif i == 3 then
                self.Panel.texts[i-1].text = "衣服"
            elseif i == 4 then
                self.Panel.texts[i-1].text = "褲腿"
            elseif i == 5 then
                self.Panel.texts[i-1].text = "鞋子"
            elseif i == 6 then
                self.Panel.texts[i-1].text = "飾品"
            end
        end
    end


    -- 显示下方装备列表（未装备）
    self.Equipments = equipments
    LoadManager:DeleteAllChilds(self.Panel.go[0])
    for k,v in pairs(self.Equipments) do
        local _Equipment = {}
        _Equipment.obj = LoadManager:Load(ABManager:LoadAsset("prefab", "Button"), self.Panel.go[0].transform, true)

        _Equipment.data = ModelTool:CopyTable(v)
        --ModelTool:SetMeta(_Equipment.data)
        --print(_Equipment.data)
        _Equipment.obj.transform:GetComponent("Image").sprite = ABManager:LoadAsset("texture", _Equipment.data.ItemID,  CS.UnityEngine.Sprite)
        _Equipment.obj.transform:Find("Text"):GetComponent("Text").text = v.Count
        _Equipment.obj.transform:GetComponent("Button").onClick:AddListener(
            function()
                -- 穿上装备
                self.HeroData = RoleCtrl:EquipHero(self.HeroData, _Equipment.data, 1)
                RoleCtrl:ShowDetailWindow(self.HeroData)
                print("当前英雄已装备：" .. self.HeroData.Equips)
            end
        )
    end

end


